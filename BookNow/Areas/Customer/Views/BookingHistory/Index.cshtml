@model List<BookNow.Application.DTOs.CustomerDTOs.BookingDTOs.BookingHistoryDTO>
@using System.Linq
@using System.Globalization

@{
    ViewData["Title"] = "My Booking History";

    // Data separation is done here in the View using the IsUpcoming helper property
    var upcomingBookings = Model.Where(b => b.IsUpcoming).ToList();
    var pastBookings = Model.Where(b => !b.IsUpcoming).OrderByDescending(b => b.ShowDateTime).ToList();
}

<style>
    /* Clean, light background for the page */
    body {
        background-color: #f8f9fa; /* Very light gray */
    }

    /* Primary brand accent color (e.g., Bootstrap primary blue or a custom red) */
    .text-title-accent {
        color: #dc3545; /* Using danger red as a strong accent, looks good on light background */
    }
</style>

<div class="container py-5 mt-4">
    @* Title is now dark and highly visible *@
    <h1 class="text-dark fw-bolder mb-5" style="font-size: 3rem;">
        <i class="bi bi-ticket-fill text-title-accent me-3"></i> Your Tickets
    </h1>

    <div class="row">
        @* ---------------------------------------------------- *@
        @* UPCOMING BOOKINGS SECTION *@
        @* ---------------------------------------------------- *@
        <div class="col-12 mb-5">
            @* Header text is now dark for visibility *@
            <h2 class="text-dark border-bottom border-title-accent pb-2 mb-4">
                <i class="bi bi-calendar-check me-2 text-title-accent"></i> Upcoming Tickets (@upcomingBookings.Count)
            </h2>

            @if (!upcomingBookings.Any())
            {
                @* Alert box is now light for better text visibility *@
                <div class="alert alert-light text-center py-5 text-secondary shadow-lg border">
                    <i class="bi bi-calendar-check fs-2 d-block mb-3"></i>
                    <h5 class="fw-bold text-dark">No Active Tickets Found</h5>
                    <p class="mb-0">You have no confirmed upcoming tickets. Time to plan a night out!</p>
                </div>
            }
            else
            {
                <div class="row">
                    @foreach (var booking in upcomingBookings)
                    {
                        @* Full-width display for the horizontal card *@
                        <div class="col-12">
                            @await Html.PartialAsync("_BookingCard", booking)
                        </div>
                    }
                </div>
            }
        </div>

        @* ------------------------------------------------ *@
        @* PAST BOOKINGS SECTION *@
        @* ------------------------------------------------ *@
        <div class="col-12">
            @* Header text is slightly muted for past tickets *@
            <h2 class="text-secondary border-bottom border-secondary pb-2 mb-4">
                <i class="bi bi-archive-fill me-2"></i> Past Bookings (@pastBookings.Count)
            </h2>

            @if (!pastBookings.Any())
            {
                @* Alert box is now light *@
                <div class="alert alert-light text-center py-4 text-secondary shadow-sm border">
                    <i class="bi bi-archive-fill fs-4 d-block mb-2"></i>
                    No past booking history found.
                </div>
            }
            else
            {
                <div class="row">
                    @foreach (var booking in pastBookings)
                    {
                        @* Full-width display, still muted with opacity for past tickets *@
                        <div class="col-12 opacity-75">
                            @await Html.PartialAsync("_BookingCard", booking)
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    @* No custom JavaScript is needed for this pure SSR implementation *@
}